<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]>      <html class="no-js"> <!--<![endif]-->
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="description" content="" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ACP 题解</title>
    <link
      rel="stylesheet"
      href="https://unpkg.com/purecss@2.0.6/build/pure-min.css"
      integrity="sha384-Uu6IeWbM+gzNVXJcM9XV3SohHtmWE+3VGi496jvgX1jyvDTXfdK+rfZc8C1Aehk5"
      crossorigin="anonymous"
    />
    <link
      href="//fonts.googleapis.com/css?family=Monda:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext"
      rel="stylesheet"
      type="text/css"
    />
    <link rel="stylesheet" href="https://unpkg.com/purecss@2.0.6/build/grids-responsive-min.css" />
    <link rel="stylesheet" href="https://unpkg.com/font-awesome@4.7.0/css/font-awesome.min.css" />
    <link rel="stylesheet" href="https://unpkg.com/katex@0.15.1/dist/katex.min.css" />
    <link rel="stylesheet" href="https://unpkg.com/highlight.js@11.3.1/styles/atom-one-light.css" />
    <link
      rel="stylesheet"
      href="https://unpkg.com/github-markdown-css@5.1.0/github-markdown-light.css"
    />
  <script defer src="../js/post.b40d710.js"></script><script defer src="../js/post/solution-acp.69f4add.js"></script><link href="../css/post-solution-acp.7c10b3d.css" rel="stylesheet"></head>

  <body>
    <!--[if lt IE 7]>
      <p class="browsehappy">
        You are using an <strong>outdated</strong> browser. Please
        <a href="#">upgrade your browser</a> to improve your experience.
      </p>
    <![endif]-->
    <div id="wrap">
      <div id="sidebar" class="pure-menu">
  <a class="pure-menu-heading" href="/index.html">yzy1</a>
  <ul class="pure-menu-list">
    <li class="pure-menu-item">
      <a href="/index.html" class="pure-menu-link"><i class="fa fa-home"></i>博客</a>
    </li>
    <li class="pure-menu-item">
      <a href="/index.html" class="pure-menu-link"><i class="fa fa-tags"></i>标签</a>
    </li>
    <li class="pure-menu-item">
      <a href="/index.html" class="pure-menu-link"><i class="fa fa-file-code-o"></i>模板</a>
    </li>
    <li class="pure-menu-item menu-item-divided">
      <a href="/index.html" class="pure-menu-link"><i class="fa fa-external-link"></i>友链</a>
    </li>
    <li class="pure-menu-item">
      <a href="/about.html" class="pure-menu-link"><i class="fa fa-user"></i>关于</a>
    </li>
  </ul>
</div>

      <div id="main">

<header>
  <h1>ACP 题解</h1>
</header>
<section class="content">
  <div class="markdown-body"><h2>Task 1</h2>
<p>交换 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo separator="true">,</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">a,b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">b</span></span></span></span></span> 两数。</p>
<p>三次异或解决。</p>
<pre><code class="hljs language-cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Swap</span><span class="hljs-params">()</span> </span>{ <span class="hljs-built_in">Xor</span>(<span class="hljs-number">1</span>), <span class="hljs-built_in">Xor</span>(<span class="hljs-number">0</span>), <span class="hljs-built_in">Xor</span>(<span class="hljs-number">1</span>); }
</code></pre>
<h2>Task 2</h2>
<p>求 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>−</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">a-b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">b</span></span></span></span></span>，自然溢出。</p>
<p>由于负数在计算机内部以补码存储，所以 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>−</mo><mi>b</mi><mo>=</mo><mi>a</mi><mo>+</mo><mo stretchy="false">(</mo><mo>−</mo><mi>b</mi><mo stretchy="false">)</mo><mo>=</mo><mi>a</mi><mo>+</mo><mo stretchy="false">(</mo><mo>∼</mo><mi>b</mi><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">a-b=a+(-b)=a+ (\sim b+1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">b</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">−</span><span class="mord mathnormal">b</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mrel">∼</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">b</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span></span>。这个问题就被转化成了 A+B Problem。我们可通过异或和与运算来模拟二进制进位加法。由于本题的整数是 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>64</mn></mrow><annotation encoding="application/x-tex">64</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">64</span></span></span></span></span> 位的，所以我们最多进位 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>64</mn></mrow><annotation encoding="application/x-tex">64</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">64</span></span></span></span></span> 次。</p>
<pre><code class="hljs language-cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Add</span><span class="hljs-params">(<span class="hljs-type">int</span> x, <span class="hljs-type">int</span> cnt)</span> </span>{
  <span class="hljs-built_in">re</span>(_, cnt) {
    <span class="hljs-built_in">Mov</span>(x ^ <span class="hljs-number">1</span>);
    <span class="hljs-built_in">Xor</span>(x ^ <span class="hljs-number">1</span>);
    <span class="hljs-built_in">Mov</span>(x);
    <span class="hljs-built_in">And</span>(x ^ <span class="hljs-number">1</span>);
    <span class="hljs-built_in">Lsh</span>(x ^ <span class="hljs-number">1</span>, <span class="hljs-number">1</span>);
    <span class="hljs-built_in">Mov</span>(x ^ <span class="hljs-number">1</span>);
    <span class="hljs-built_in">Swap</span>();
    <span class="hljs-built_in">Mov</span>(x);
    <span class="hljs-built_in">Xor</span>(x);
    <span class="hljs-built_in">Pop</span>(x ^ <span class="hljs-number">1</span>);
  }
  <span class="hljs-built_in">Pop</span>(x ^ <span class="hljs-number">1</span>);
}

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Fu</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span> </span>{
  <span class="hljs-built_in">Not</span>(x);
  <span class="hljs-built_in">Not</span>(x ^ <span class="hljs-number">1</span>);
  <span class="hljs-built_in">Rsh</span>(x ^ <span class="hljs-number">1</span>, <span class="hljs-number">63</span>);
  <span class="hljs-built_in">Add</span>(x, <span class="hljs-number">64</span>);
}

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">St2</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-built_in">Fu</span>(<span class="hljs-number">0</span>);
  <span class="hljs-built_in">Mov</span>(<span class="hljs-number">0</span>);
  <span class="hljs-built_in">Add</span>(<span class="hljs-number">1</span>, <span class="hljs-number">64</span>);
}
</code></pre>
<h2>Task 3</h2>
<p>实现十进制整数快读。</p>
<p>既然我们已经实现加减法了，就可以写一个快读了。但是如果直接暴力减 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>48</mn></mrow><annotation encoding="application/x-tex">48</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">48</span></span></span></span></span>，暴力做十次加法当乘法的话，汇编指令长度会超限。这里有两个小技巧。</p>
<ol>
<li>当计算减 <code>0</code> 的 ASCII 码（即 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>48</mn></mrow><annotation encoding="application/x-tex">48</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">48</span></span></span></span></span>）的时候，我们发现 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mn>48</mn><mo separator="true">,</mo><mn>57</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[48,57]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">48</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">57</span><span class="mclose">]</span></span></span></span></span> 内的整数在与 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>48</mn></mrow><annotation encoding="application/x-tex">48</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">48</span></span></span></span></span> 做二进制减法时都不会「退位」。所以我们可以用一次异或运算来代替减法。</li>
<li>在计算乘 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>10</mn></mrow><annotation encoding="application/x-tex">10</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">10</span></span></span></span></span> 时，我们可以把 <code>x*=10</code> 转化为 <code>x+=x&#x3C;&#x3C;2;x&#x3C;&#x3C;1</code>。这样可以尽可能的减少加法运算。</li>
</ol>
<pre><code class="hljs language-cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">St3</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-type">int</span> n = <span class="hljs-number">9</span>;
  <span class="hljs-built_in">re</span>(i, n) {
    <span class="hljs-built_in">Not</span>(<span class="hljs-number">1</span>);
    <span class="hljs-built_in">Lsh</span>(<span class="hljs-number">1</span>, <span class="hljs-number">62</span>);
    <span class="hljs-built_in">Rsh</span>(<span class="hljs-number">1</span>, <span class="hljs-number">58</span>);  <span class="hljs-comment">// 48</span>
    <span class="hljs-built_in">Xor</span>(<span class="hljs-number">0</span>);      <span class="hljs-comment">// -48</span>
    <span class="hljs-built_in">Pop</span>(<span class="hljs-number">1</span>);
    <span class="hljs-keyword">if</span> (i != <span class="hljs-number">1</span>) {
      <span class="hljs-built_in">Add</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">ceil</span>(<span class="hljs-built_in">log2</span>(<span class="hljs-number">2</span> * <span class="hljs-built_in">pow</span>(<span class="hljs-number">10</span>, i - <span class="hljs-number">1</span>))));
    }
    <span class="hljs-keyword">if</span> (i != n) {
      <span class="hljs-comment">// x*=10 -> x+=x&#x3C;&#x3C;2;x&#x3C;&#x3C;1</span>
      <span class="hljs-built_in">Xor</span>(<span class="hljs-number">1</span>);
      <span class="hljs-built_in">Lsh</span>(<span class="hljs-number">0</span>, <span class="hljs-number">2</span>);
      <span class="hljs-built_in">Add</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">ceil</span>(<span class="hljs-built_in">log2</span>(<span class="hljs-built_in">pow</span>(<span class="hljs-number">10</span>, i))));
      <span class="hljs-built_in">Lsh</span>(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>);
      <span class="hljs-built_in">Swap</span>();  <span class="hljs-comment">// 让最顶上变成 0</span>
      <span class="hljs-built_in">Mov</span>(<span class="hljs-number">0</span>);
    }
  }
  <span class="hljs-built_in">Mov</span>(<span class="hljs-number">0</span>);
}
</code></pre>
<h2>Task 4</h2>
<p>求 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi mathvariant="normal">popcnt</mi><mo>⁡</mo><mi>x</mi><mo stretchy="false">)</mo><mtext> </mtext><mo lspace="0.22em" rspace="0.22em"><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow></mo><mtext> </mtext><mn>2</mn></mrow><annotation encoding="application/x-tex">(\operatorname{popcnt}x) \bmod 2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mop"><span class="mord mathrm">popcnt</span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.0556em;"></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.0556em;"></span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span></span></span></span></span>。</p>
<p>考虑二分，<code>x^=x>>32, x^=x>>16, x^=x>>8, ..., x^=x>>1</code>。答案为 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mtext> </mtext><mo lspace="0.22em" rspace="0.22em"><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow></mo><mtext> </mtext><mn>2</mn></mrow><annotation encoding="application/x-tex">x \bmod 2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.0556em;"></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.0556em;"></span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span></span></span></span></span>。</p>
<pre><code class="hljs language-cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">St4</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">32</span>; i; i >>= <span class="hljs-number">1</span>) {
    <span class="hljs-built_in">Xor</span>(i == <span class="hljs-number">32</span>);
    <span class="hljs-built_in">Rsh</span>(<span class="hljs-number">0</span>, i);
    <span class="hljs-built_in">Xor</span>(<span class="hljs-number">1</span>);
    <span class="hljs-built_in">Pop</span>(<span class="hljs-number">0</span>);
  }
  <span class="hljs-built_in">Lsh</span>(<span class="hljs-number">1</span>, <span class="hljs-number">63</span>);
  <span class="hljs-built_in">Rsh</span>(<span class="hljs-number">1</span>, <span class="hljs-number">63</span>);
}
</code></pre>
<h2>Task 5</h2>
<p>求 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>min</mi><mo>⁡</mo><mo stretchy="false">{</mo><mi>a</mi><mo separator="true">,</mo><mi>b</mi><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">\min\{a,b\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop">min</span><span class="mopen">{</span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">b</span><span class="mclose">}</span></span></span></span></span>。</p>
<p>考虑异或运算的性质。设 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>=</mo><mi>a</mi><mo>⊕</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">t=a\oplus b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">b</span></span></span></span></span>，则 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span></span></span></span></span> 正好是 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">a</span></span></span></span></span> 与 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi></mrow><annotation encoding="application/x-tex">b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">b</span></span></span></span></span> 中<strong>零一不同</strong>的位。而将 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>&#x26;</mo><mi>a</mi></mrow><annotation encoding="application/x-tex">t\And a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">&#x26;</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">a</span></span></span></span></span> 得到的结果是这些不同的位中哪些位 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">a</span></span></span></span></span> 为 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span></span>。同理，<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>&#x26;</mo><mi>a</mi></mrow><annotation encoding="application/x-tex">t\And a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">&#x26;</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">a</span></span></span></span></span> 得到哪些位 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi></mrow><annotation encoding="application/x-tex">b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">b</span></span></span></span></span> 为 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span></span>。我们只要比较 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>&#x26;</mo><mi>a</mi></mrow><annotation encoding="application/x-tex">t\And a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">&#x26;</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">a</span></span></span></span></span> 和 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>&#x26;</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">t \And b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">&#x26;</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">b</span></span></span></span></span> 的大小关系，就可以得出 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">a</span></span></span></span></span> 和 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi></mrow><annotation encoding="application/x-tex">b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">b</span></span></span></span></span> 的大小关系。考虑拼一个运算符 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">hibFill</mi><mo>⁡</mo><mi>x</mi></mrow><annotation encoding="application/x-tex">\operatorname{hibFill} x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mop"><span class="mord mathrm">hibFill</span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">x</span></span></span></span></span>。它的作用是将 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span></span> 的第一个 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span></span> 后的位全填充为 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span></span>。这样的话如果 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">hibFill</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>t</mi><mo>&#x26;</mo><mi>a</mi><mo stretchy="false">)</mo><mo>&#x26;</mo><mi mathvariant="normal">hibFill</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>t</mi><mo>&#x26;</mo><mi>b</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\operatorname{hibFill}(t\And a)\And \operatorname{hibFill}(t \And b)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop"><span class="mord mathrm">hibFill</span></span><span class="mopen">(</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">&#x26;</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">a</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">&#x26;</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop"><span class="mord mathrm">hibFill</span></span><span class="mopen">(</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">&#x26;</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">b</span><span class="mclose">)</span></span></span></span></span> 不为零，则 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>></mo><mi>b</mi></mrow><annotation encoding="application/x-tex">a>b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">></span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">b</span></span></span></span></span>，否则 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>&#x3C;</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">a&#x3C;b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&#x3C;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">b</span></span></span></span></span>。<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">hibFill</mi><mo>⁡</mo></mrow><annotation encoding="application/x-tex">\operatorname{hibFill}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mop"><span class="mord mathrm">hibFill</span></span></span></span></span></span> 的实现利用倍增思想，类似于 Task 4，只不过将左移改成了右移。具体实现请参考代码。</p>
<p>但是这样会略微有些超出指令长度范围，我们需要优化一下。可以发现 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span></span></span></span></span> 与 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi></mrow><annotation encoding="application/x-tex">b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">b</span></span></span></span></span> 的运算是不必要的。我们可以直接比较 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span></span></span></span></span> 的最高位是否在 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">a</span></span></span></span></span> 中，如果在则 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>></mo><mi>b</mi></mrow><annotation encoding="application/x-tex">a>b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">></span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">b</span></span></span></span></span>，否则 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>&#x3C;</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">a&#x3C;b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&#x3C;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">b</span></span></span></span></span>。由于这题要求输出的是 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo separator="true">,</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">a,b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">b</span></span></span></span></span> 中较小者，所以我们怎么处理 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>=</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">a=b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">b</span></span></span></span></span> 的情况都可以。</p>
<p>剩下的事情就好办了，考虑拼一个 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">if</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>c</mi><mi>o</mi><mi>n</mi><mo separator="true">,</mo><mi>a</mi><mo separator="true">,</mo><mi>b</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\operatorname{if}(con,a,b)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop"><span class="mord mathrm" style="margin-right:0.07778em;">if</span></span><span class="mopen">(</span><span class="mord mathnormal">co</span><span class="mord mathnormal">n</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">b</span><span class="mclose">)</span></span></span></span></span> 运算符，它的作用类似于 C++ 中的 <code>if(con)return b;else return a</code>。这样我们就能求出答案了。</p>
<pre><code class="hljs language-cpp"><span class="hljs-comment">// 将第一个 1 后的位全填充为 1</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">HibFill</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span> </span>{
  <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">32</span>; i; i >>= <span class="hljs-number">1</span>) {
    <span class="hljs-built_in">Xor</span>(x ^ <span class="hljs-number">1</span>);
    <span class="hljs-built_in">Rsh</span>(x ^ <span class="hljs-number">1</span>, i);
    <span class="hljs-built_in">Or</span>(x);
    <span class="hljs-built_in">Pop</span>(x ^ <span class="hljs-number">1</span>);
  }
}

<span class="hljs-comment">// 两数都在 S[0]</span>
<span class="hljs-comment">// pop S[0] 的两数并将比较结果放在原位置</span>
<span class="hljs-comment">// 输入 [b a] 输出 [a&#x3C;b]</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Cmp</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-built_in">Xor</span>(<span class="hljs-number">1</span>);  <span class="hljs-comment">// [a b] [b]</span>
  <span class="hljs-built_in">Mov</span>(<span class="hljs-number">0</span>);  <span class="hljs-comment">// [a] [b b]</span>
  <span class="hljs-built_in">Xor</span>(<span class="hljs-number">1</span>);  <span class="hljs-comment">// [a] [b t]</span>
  <span class="hljs-built_in">Mov</span>(<span class="hljs-number">1</span>);  <span class="hljs-comment">// [a t] [b]</span>
  <span class="hljs-built_in">Swap</span>();  <span class="hljs-comment">// [a b] [t]</span>
  <span class="hljs-built_in">Mov</span>(<span class="hljs-number">1</span>);  <span class="hljs-comment">// [a b t] []</span>
  <span class="hljs-built_in">HibFill</span>(<span class="hljs-number">0</span>);
  <span class="hljs-built_in">Xor</span>(<span class="hljs-number">1</span>);
  <span class="hljs-built_in">Rsh</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>);
  <span class="hljs-built_in">Xor</span>(<span class="hljs-number">0</span>);
  <span class="hljs-built_in">Pop</span>(<span class="hljs-number">1</span>);  <span class="hljs-comment">// [a b t] []</span>
  <span class="hljs-built_in">Mov</span>(<span class="hljs-number">0</span>);  <span class="hljs-comment">// [a b] [t]</span>
  <span class="hljs-built_in">Pop</span>(<span class="hljs-number">0</span>);
  <span class="hljs-built_in">And</span>(<span class="hljs-number">0</span>);
  <span class="hljs-built_in">Pop</span>(<span class="hljs-number">1</span>);  <span class="hljs-comment">// [a] []</span>
  <span class="hljs-built_in">HibFill</span>(<span class="hljs-number">0</span>);
  <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">1</span>; i &#x3C;= <span class="hljs-number">32</span>; i &#x3C;&#x3C;= <span class="hljs-number">1</span>) {
    <span class="hljs-built_in">Or</span>(<span class="hljs-number">1</span>);
    <span class="hljs-built_in">Lsh</span>(<span class="hljs-number">1</span>, i);
    <span class="hljs-built_in">Or</span>(<span class="hljs-number">0</span>);
  }
  <span class="hljs-built_in">Pop</span>(<span class="hljs-number">1</span>);
}

<span class="hljs-comment">// [a b con]</span>
<span class="hljs-comment">// 输入至 S_x，pop x, pop x，输出至 S_x^1</span>
<span class="hljs-comment">// if(con) b; else a</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">If</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span> </span>{
  <span class="hljs-built_in">Mov</span>(x);      <span class="hljs-comment">// [a b] [con]</span>
  <span class="hljs-built_in">Swap</span>();      <span class="hljs-comment">// [a con] [b]</span>
  <span class="hljs-built_in">And</span>(x ^ <span class="hljs-number">1</span>);  <span class="hljs-comment">// [a con] [b&#x26;con]</span>
  <span class="hljs-built_in">Not</span>(x);      <span class="hljs-comment">// [a !con] [b&#x26;con]</span>
  <span class="hljs-built_in">Mov</span>(x);      <span class="hljs-comment">// [a] [b&#x26;con !con]</span>
  <span class="hljs-built_in">And</span>(x);      <span class="hljs-comment">// [a&#x26;!con] [b&#x26;con !con]</span>
  <span class="hljs-built_in">Pop</span>(x ^ <span class="hljs-number">1</span>);  <span class="hljs-comment">// [a&#x26;!con] [b&#x26;con]</span>
  <span class="hljs-built_in">Or</span>(x ^ <span class="hljs-number">1</span>);
  <span class="hljs-built_in">Pop</span>(x);
}

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">St5</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-built_in">Xor</span>(<span class="hljs-number">1</span>);  <span class="hljs-comment">// [a b] [b]</span>
  <span class="hljs-built_in">Mov</span>(<span class="hljs-number">0</span>);  <span class="hljs-comment">// [a] [b b]</span>
  <span class="hljs-built_in">Mov</span>(<span class="hljs-number">0</span>);  <span class="hljs-comment">// [] [b b a]</span>
  <span class="hljs-built_in">Xor</span>(<span class="hljs-number">0</span>);  <span class="hljs-comment">// [a] [b b a]</span>
  <span class="hljs-built_in">Mov</span>(<span class="hljs-number">1</span>);  <span class="hljs-comment">// [a a] [b b]</span>
  <span class="hljs-built_in">Swap</span>();  <span class="hljs-comment">// [a b] [b a]</span>
  <span class="hljs-built_in">Mov</span>(<span class="hljs-number">1</span>);  <span class="hljs-comment">// [a b a] [b]</span>
  <span class="hljs-built_in">Mov</span>(<span class="hljs-number">1</span>);  <span class="hljs-comment">// [a b a b] []</span>
  <span class="hljs-built_in">Cmp</span>();
  <span class="hljs-built_in">If</span>(<span class="hljs-number">0</span>);
}
</code></pre>
<h2>Task 6</h2>
<p>求 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>×</mo><mi>b</mi><mtext> </mtext><mo lspace="0.22em" rspace="0.22em"><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow></mo><mtext> </mtext><mi>p</mi></mrow><annotation encoding="application/x-tex">a \times b \bmod p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">b</span><span class="mspace" style="margin-right:0.0556em;"></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin"><span class="mord"><span class="mord mathrm">mod</span></span></span><span class="mspace" style="margin-right:0.0556em;"></span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span></span></span></span></span>。</p>
<p>我们现在有加法，有 <code>if</code>，我们就可以搞一个乘法了。由于 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo separator="true">,</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">a,b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">b</span></span></span></span></span> 的范围都在 <code>unsigned long long</code> 级别，我们考虑一个类似于快速幂的「快速乘」：</p>
<pre><code class="hljs language-cpp">(伪代码)
<span class="hljs-type">int</span> ans=<span class="hljs-number">0</span>;
<span class="hljs-keyword">for</span> i=<span class="hljs-number">1.</span>.<span class="hljs-number">.64</span> {
  <span class="hljs-keyword">if</span>(a&#x26;<span class="hljs-number">1</span>) ans+=b;
  a>>=<span class="hljs-number">1</span>;
  b&#x3C;&#x3C;=<span class="hljs-number">1</span>;
}
<span class="hljs-keyword">return</span> ans;
</code></pre>
<p>仿照快速幂的思想，设 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi><mo>=</mo><msup><mn>2</mn><msub><mi>i</mi><mn>1</mn></msub></msup><mo>+</mo><msup><mn>2</mn><msub><mi>i</mi><mn>2</mn></msub></msup><mo>+</mo><mo>⋯</mo><mo>+</mo><msup><mn>2</mn><msub><mi>i</mi><mi>k</mi></msub></msup></mrow><annotation encoding="application/x-tex">b=2^{i_1}+2^{i_2}+\cdots+2^{i_k}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">b</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.908em;vertical-align:-0.0833em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8247em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.908em;vertical-align:-0.0833em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8247em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8247em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8247em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3488em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1512em;"><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>，根据乘法分配律，将 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>×</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">a\times b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">b</span></span></span></span></span> 拆分成 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>×</mo><msup><mn>2</mn><msub><mi>i</mi><mn>1</mn></msub></msup><mo>+</mo><mi>a</mi><mo>×</mo><msup><mn>2</mn><msub><mi>i</mi><mn>2</mn></msub></msup><mo>+</mo><mo>⋯</mo><mo>+</mo><mi>a</mi><mo>×</mo><msup><mn>2</mn><msub><mi>i</mi><mi>k</mi></msub></msup></mrow><annotation encoding="application/x-tex">a\times 2^{i_1}+a\times 2^{i_2}+\cdots+a\times 2^{i_k}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.908em;vertical-align:-0.0833em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8247em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.908em;vertical-align:-0.0833em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8247em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8247em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8247em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3488em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1512em;"><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>。复杂度 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>log</mi><mo>⁡</mo><mi>b</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(\log b)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">b</span><span class="mclose">)</span></span></span></span></span>。但是因为只能同时操纵两个栈的栈顶元素，我们需要不断的 <code>Swap()</code>。实际写起来有点麻烦。由于模数是 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn></mrow><annotation encoding="application/x-tex">2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span></span></span></span></span> 的整数次幂，我们可以先自然溢出，最后再取模。</p>
<pre><code class="hljs language-cpp"><span class="hljs-comment">// 乘法</span>
<span class="hljs-comment">// 在 S0 上输入 0,a,b; (pop 0)*3; out to S1</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Mul</span><span class="hljs-params">(<span class="hljs-type">int</span> x, <span class="hljs-type">int</span> cnt)</span> </span>{
  <span class="hljs-comment">// [0 a b] []</span>
  <span class="hljs-built_in">Xor</span>(x ^ <span class="hljs-number">1</span>);  <span class="hljs-comment">// [0 a b] [b]</span>
  <span class="hljs-built_in">Mov</span>(x);      <span class="hljs-comment">// [0 a] [b b]</span>
  <span class="hljs-built_in">Swap</span>();      <span class="hljs-comment">// [0 b] [b a]</span>
  <span class="hljs-built_in">Mov</span>(x ^ <span class="hljs-number">1</span>);  <span class="hljs-comment">// [0 b a] [b]</span>
  <span class="hljs-built_in">Swap</span>();      <span class="hljs-comment">// [0 b b] [a]</span>
  <span class="hljs-built_in">re</span>(k, cnt) {
    <span class="hljs-comment">// [ans b b] [a]</span>
    <span class="hljs-built_in">Mov</span>(x ^ <span class="hljs-number">1</span>);
    <span class="hljs-built_in">Xor</span>(x ^ <span class="hljs-number">1</span>);  <span class="hljs-comment">// [ans b b a] [a]</span>
    <span class="hljs-built_in">Mov</span>(x ^ <span class="hljs-number">1</span>);
    <span class="hljs-built_in">Not</span>(x ^ <span class="hljs-number">1</span>);
    <span class="hljs-built_in">Rsh</span>(x ^ <span class="hljs-number">1</span>, <span class="hljs-number">63</span>);  <span class="hljs-comment">// [ans b b a a] [1]</span>
    <span class="hljs-built_in">And</span>(x);
    <span class="hljs-built_in">Pop</span>(x ^ <span class="hljs-number">1</span>);  <span class="hljs-comment">// [ans b b a a&#x26;1] []</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">1</span>; i &#x3C;= <span class="hljs-number">32</span>; i &#x3C;&#x3C;= <span class="hljs-number">1</span>) {
      <span class="hljs-built_in">Or</span>(x ^ <span class="hljs-number">1</span>);
      <span class="hljs-built_in">Lsh</span>(x ^ <span class="hljs-number">1</span>, i);
      <span class="hljs-built_in">Or</span>(x);
    }
    <span class="hljs-built_in">Pop</span>(x ^ <span class="hljs-number">1</span>);
    <span class="hljs-built_in">Mov</span>(x);
    <span class="hljs-built_in">Mov</span>(x);
    <span class="hljs-comment">// [ans b b] [f a]</span>
    <span class="hljs-built_in">Swap</span>();      <span class="hljs-comment">// [ans b a] [f b]</span>
    <span class="hljs-built_in">Mov</span>(x ^ <span class="hljs-number">1</span>);  <span class="hljs-comment">// [ans b a b] [f]</span>
    <span class="hljs-built_in">Swap</span>();      <span class="hljs-comment">// [ans b a f] [b]</span>
    <span class="hljs-built_in">Mov</span>(x ^ <span class="hljs-number">1</span>);  <span class="hljs-comment">// [ans b a f b] []</span>
    <span class="hljs-built_in">Mov</span>(x);
    <span class="hljs-built_in">Mov</span>(x);
    <span class="hljs-built_in">Mov</span>(x);
    <span class="hljs-built_in">Mov</span>(x);      <span class="hljs-comment">// [ans] [b f a b]</span>
    <span class="hljs-built_in">Swap</span>();      <span class="hljs-comment">// [b] [b f a ans]</span>
    <span class="hljs-built_in">Mov</span>(x ^ <span class="hljs-number">1</span>);  <span class="hljs-comment">// [b ans] [b f a]</span>
    <span class="hljs-built_in">Swap</span>();      <span class="hljs-comment">// [b a] [b f ans]</span>
    <span class="hljs-built_in">Mov</span>(x ^ <span class="hljs-number">1</span>);  <span class="hljs-comment">// [b a ans] [b f]</span>
    <span class="hljs-built_in">Swap</span>();      <span class="hljs-comment">// [b a f] [b ans]</span>
    <span class="hljs-built_in">Mov</span>(x ^ <span class="hljs-number">1</span>);  <span class="hljs-comment">// [b a f ans] [b]</span>
    <span class="hljs-built_in">Swap</span>();      <span class="hljs-comment">// [b a f b] [ans]</span>
    <span class="hljs-built_in">Mov</span>(x ^ <span class="hljs-number">1</span>);
    <span class="hljs-built_in">Xor</span>(x ^ <span class="hljs-number">1</span>);  <span class="hljs-comment">// [b a f b ans] [ans]</span>
    <span class="hljs-built_in">Mov</span>(x);      <span class="hljs-comment">// [b a f b] [ans ans]</span>
    <span class="hljs-built_in">Swap</span>();      <span class="hljs-comment">// [b a f ans] [ans b]</span>
    <span class="hljs-built_in">Mov</span>(x ^ <span class="hljs-number">1</span>);  <span class="hljs-comment">// [b a f ans b] [ans]</span>
    <span class="hljs-built_in">Swap</span>();      <span class="hljs-comment">// [b a f ans ans] [b]</span>
    <span class="hljs-built_in">Add</span>(x, <span class="hljs-number">64</span>);  <span class="hljs-comment">// [b a f ans ans+b] []</span>
    <span class="hljs-built_in">Mov</span>(x);      <span class="hljs-comment">// [b a f ans] [ans+b]</span>
    <span class="hljs-built_in">Swap</span>();
    <span class="hljs-built_in">Mov</span>(x);
    <span class="hljs-built_in">Swap</span>();
    <span class="hljs-built_in">Mov</span>(x ^ <span class="hljs-number">1</span>);
    <span class="hljs-built_in">Swap</span>();
    <span class="hljs-built_in">Mov</span>(x ^ <span class="hljs-number">1</span>);
    <span class="hljs-built_in">Not</span>(x);
    <span class="hljs-comment">// [b a ans+b ans !f] []</span>
    <span class="hljs-built_in">If</span>(x);
    <span class="hljs-comment">// [b a] [f?ans+b:ans]</span>
    <span class="hljs-comment">// [b a] [ans]</span>
    <span class="hljs-keyword">if</span> (k == cnt) {
      <span class="hljs-built_in">Pop</span>(x);
      <span class="hljs-built_in">Pop</span>(x);
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-built_in">Rsh</span>(x, <span class="hljs-number">1</span>);
      <span class="hljs-built_in">Swap</span>();
      <span class="hljs-built_in">Mov</span>(x);
      <span class="hljs-built_in">Swap</span>();
      <span class="hljs-comment">// [ans] [a b]</span>
      <span class="hljs-built_in">Lsh</span>(x ^ <span class="hljs-number">1</span>, <span class="hljs-number">1</span>);
      <span class="hljs-built_in">Mov</span>(x ^ <span class="hljs-number">1</span>);  <span class="hljs-comment">// [ans b] [a]</span>
      <span class="hljs-built_in">Swap</span>();      <span class="hljs-comment">// [ans a] [b]</span>
      <span class="hljs-built_in">Mov</span>(x ^ <span class="hljs-number">1</span>);
      <span class="hljs-built_in">Xor</span>(x ^ <span class="hljs-number">1</span>);  <span class="hljs-comment">// [ans a b] [b]</span>
      <span class="hljs-built_in">Mov</span>(x);
      <span class="hljs-built_in">Swap</span>();
      <span class="hljs-built_in">Mov</span>(x ^ <span class="hljs-number">1</span>);
      <span class="hljs-built_in">Swap</span>();  <span class="hljs-comment">// [ans b b] [a]</span>
    }
  }
}

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">St6</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-built_in">Xor</span>(<span class="hljs-number">1</span>);
  <span class="hljs-built_in">Rsh</span>(<span class="hljs-number">0</span>, <span class="hljs-number">64</span>);
  <span class="hljs-built_in">Mov</span>(<span class="hljs-number">0</span>);
  <span class="hljs-built_in">Mov</span>(<span class="hljs-number">0</span>);
  <span class="hljs-built_in">Mov</span>(<span class="hljs-number">0</span>);
  <span class="hljs-built_in">Mul</span>(<span class="hljs-number">1</span>, <span class="hljs-number">63</span>);
  <span class="hljs-built_in">Mov</span>(<span class="hljs-number">1</span>);
  <span class="hljs-built_in">Rsh</span>(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>);
  <span class="hljs-built_in">LowbitFill</span>(<span class="hljs-number">0</span>);
  <span class="hljs-built_in">Mov</span>(<span class="hljs-number">0</span>);
  <span class="hljs-built_in">And</span>(<span class="hljs-number">1</span>);
}
</code></pre>
<h2>Task 7</h2>
<p>求 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msqrt><mi>a</mi></msqrt></mrow><annotation encoding="application/x-tex">\sqrt a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.04em;vertical-align:-0.2397em;"></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8003em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="padding-left:0.833em;">a</span></span><span style="top:-2.7603em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="1.08em" viewBox="0 0 400000 1080" preserveAspectRatio="xMinYMin slice"><path d="M95,702
c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14
c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54
c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10
s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429
c69,-144,104.5,-217.7,106.5,-221
l0 -0
c5.3,-9.3,12,-14,20,-14
H400000v40H845.2724
s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7
c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z
M834 80h400000v40h-400000z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2397em;"><span></span></span></span></span></span></span></span></span></span>，满足答案是 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn></mrow><annotation encoding="application/x-tex">2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span></span></span></span></span> 的整数次幂。</p>
<p>手推一下发现只有输入 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">a</span></span></span></span></span> 是 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mn>0</mn></msup><mo separator="true">,</mo><msup><mn>2</mn><mn>2</mn></msup><mo separator="true">,</mo><msup><mn>2</mn><mn>4</mn></msup></mrow><annotation encoding="application/x-tex">2^0, 2^2, 2^4</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0085em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">4</span></span></span></span></span></span></span></span></span></span></span></span> 等 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn></mrow><annotation encoding="application/x-tex">2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span></span></span></span></span> 的偶数次方时才有合法答案。且 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>=</mo><msup><mn>2</mn><mi>k</mi></msup></mrow><annotation encoding="application/x-tex">a=2^k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8491em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8491em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span></span></span></span></span></span></span></span> 时答案一定是 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mrow><mi>k</mi><mi mathvariant="normal">/</mi><mn>2</mn></mrow></msup></mrow><annotation encoding="application/x-tex">2^{k/2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.888em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.888em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mord mtight">/2</span></span></span></span></span></span></span></span></span></span></span></span></span>。两位两位左移并判断即可。</p>
<pre><code class="hljs language-cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">St7</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-built_in">ste</span>(k, <span class="hljs-number">0</span>, <span class="hljs-number">62</span>, <span class="hljs-number">2</span>) {
    <span class="hljs-built_in">Not</span>(<span class="hljs-number">1</span>);
    <span class="hljs-built_in">Rsh</span>(<span class="hljs-number">1</span>, <span class="hljs-number">63</span>);
    <span class="hljs-built_in">Lsh</span>(<span class="hljs-number">1</span>, k);
    <span class="hljs-built_in">And</span>(<span class="hljs-number">1</span>);  <span class="hljs-comment">// [a] [ans 1&#x3C;&#x3C;k]</span>
    <span class="hljs-built_in">Rsh</span>(<span class="hljs-number">1</span>, k / <span class="hljs-number">2</span>);
    <span class="hljs-built_in">Mov</span>(<span class="hljs-number">1</span>);  <span class="hljs-comment">// [a 1&#x3C;&#x3C;k/2] [ans]</span>
    <span class="hljs-built_in">Or</span>(<span class="hljs-number">1</span>);
    <span class="hljs-keyword">if</span> (k != <span class="hljs-number">62</span>) {
      <span class="hljs-built_in">Mov</span>(<span class="hljs-number">0</span>);
      <span class="hljs-built_in">Rsh</span>(<span class="hljs-number">1</span>, <span class="hljs-number">64</span>);  <span class="hljs-comment">// [a] [ans 0]</span>
    }
  }
}
</code></pre>
<h2>Task 8</h2>
<p>求 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>gcd</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>a</mi><mo separator="true">,</mo><mi>b</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\gcd(a,b)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop"><span style="margin-right:0.01389em;">g</span>cd</span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">b</span><span class="mclose">)</span></span></span></span></span>。</p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>gcd</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>a</mi><mo separator="true">,</mo><mi>b</mi><mo stretchy="false">)</mo><mo>=</mo><mi>gcd</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>max</mi><mo>⁡</mo><mo stretchy="false">{</mo><mi>a</mi><mo separator="true">,</mo><mi>b</mi><mo stretchy="false">}</mo><mo>−</mo><mi>min</mi><mo>⁡</mo><mo stretchy="false">{</mo><mi>a</mi><mo separator="true">,</mo><mi>b</mi><mo stretchy="false">}</mo><mo separator="true">,</mo><mi>min</mi><mo>⁡</mo><mo stretchy="false">{</mo><mi>a</mi><mo separator="true">,</mo><mi>b</mi><mo stretchy="false">}</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\gcd(a,b)=\gcd(\max\{a,b\}-\min\{a,b\},\min\{a,b\})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop"><span style="margin-right:0.01389em;">g</span>cd</span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">b</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop"><span style="margin-right:0.01389em;">g</span>cd</span><span class="mopen">(</span><span class="mop">max</span><span class="mopen">{</span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">b</span><span class="mclose">}</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop">min</span><span class="mopen">{</span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">b</span><span class="mclose">}</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop">min</span><span class="mopen">{</span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">b</span><span class="mclose">})</span></span></span></span></span>。不断求最大最小值并相减，直到其中一数为 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span></span></span></span>。最差情况发生在 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>=</mo><mn>63</mn><mo separator="true">,</mo><mi>b</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">a=63,b=1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord">63</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">b</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span></span> 时，需要减 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>62</mn></mrow><annotation encoding="application/x-tex">62</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">62</span></span></span></span></span> 次。</p>
<pre><code class="hljs language-cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">St8</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-type">int</span> n = <span class="hljs-number">62</span>;
  <span class="hljs-built_in">re</span>(k, n) {
    <span class="hljs-built_in">Xor</span>(<span class="hljs-number">1</span>);
    <span class="hljs-built_in">Mov</span>(<span class="hljs-number">1</span>);  <span class="hljs-comment">// [a b b] []</span>
    <span class="hljs-built_in">Xor</span>(<span class="hljs-number">1</span>);
    <span class="hljs-built_in">Mov</span>(<span class="hljs-number">0</span>);  <span class="hljs-comment">// [a b] [b b]</span>
    <span class="hljs-built_in">Mov</span>(<span class="hljs-number">0</span>);  <span class="hljs-comment">// [a] [b b b]</span>
    <span class="hljs-built_in">Mov</span>(<span class="hljs-number">0</span>);
    <span class="hljs-built_in">Xor</span>(<span class="hljs-number">0</span>);  <span class="hljs-comment">// [a] [b b b a]</span>
    <span class="hljs-built_in">Mov</span>(<span class="hljs-number">1</span>);  <span class="hljs-comment">// [a a] [b b b]</span>
    <span class="hljs-built_in">Xor</span>(<span class="hljs-number">1</span>);  <span class="hljs-comment">// [a a] [b b a^b]</span>
    <span class="hljs-built_in">Swap</span>();  <span class="hljs-comment">// [a a^b] [b b a]</span>
    <span class="hljs-built_in">Mov</span>(<span class="hljs-number">0</span>);
    <span class="hljs-built_in">Swap</span>();  <span class="hljs-comment">// [a^b] [b b a a]</span>
    <span class="hljs-built_in">Mov</span>(<span class="hljs-number">1</span>);
    <span class="hljs-built_in">Mov</span>(<span class="hljs-number">1</span>);  <span class="hljs-comment">// [a^b a a] [b b]</span>
    <span class="hljs-built_in">Swap</span>();  <span class="hljs-comment">// [a^b a b] [b a]</span>
    <span class="hljs-built_in">Mov</span>(<span class="hljs-number">1</span>);
    <span class="hljs-built_in">Mov</span>(<span class="hljs-number">1</span>);  <span class="hljs-comment">// [a^b a b a b] []</span>
    <span class="hljs-built_in">Cmp</span>(<span class="hljs-number">0</span>);  <span class="hljs-comment">// [a^b a b f]</span>
    <span class="hljs-built_in">If</span>(<span class="hljs-number">0</span>);   <span class="hljs-comment">// [a^b] [min]</span>
    <span class="hljs-built_in">Xor</span>(<span class="hljs-number">0</span>);  <span class="hljs-comment">// [max] [min]</span>
    <span class="hljs-built_in">Mov</span>(<span class="hljs-number">1</span>);
    <span class="hljs-built_in">Xor</span>(<span class="hljs-number">1</span>);  <span class="hljs-comment">// [max min] [min]</span>
    <span class="hljs-built_in">Mov</span>(<span class="hljs-number">1</span>);
    <span class="hljs-built_in">Fu</span>(<span class="hljs-number">0</span>);  <span class="hljs-comment">// [max min -min] []</span>
    <span class="hljs-built_in">Mov</span>(<span class="hljs-number">0</span>);
    <span class="hljs-built_in">Swap</span>();     <span class="hljs-comment">// [max -min] [min]</span>
    <span class="hljs-built_in">Mov</span>(<span class="hljs-number">0</span>);     <span class="hljs-comment">// [max] [min -min]</span>
    <span class="hljs-built_in">Add</span>(<span class="hljs-number">1</span>, <span class="hljs-number">6</span>);  <span class="hljs-comment">// [] [min max-min]</span>
    <span class="hljs-built_in">Not</span>(<span class="hljs-number">0</span>);
    <span class="hljs-built_in">Rsh</span>(<span class="hljs-number">0</span>, <span class="hljs-number">58</span>);
    <span class="hljs-built_in">And</span>(<span class="hljs-number">1</span>);
    <span class="hljs-built_in">Pop</span>(<span class="hljs-number">0</span>);
    <span class="hljs-built_in">Mov</span>(<span class="hljs-number">1</span>);
    <span class="hljs-keyword">if</span> (k == n)
      <span class="hljs-built_in">Or</span>(<span class="hljs-number">1</span>);
    <span class="hljs-keyword">else</span>
      <span class="hljs-built_in">Mov</span>(<span class="hljs-number">1</span>);
  }
}
</code></pre></div>
</section>
      </div>
    </div>
    <script src="https://unpkg.com/jquery@3.6.0/dist/jquery.min.js"></script>
  </body>
</html>

