<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]>      <html class="no-js"> <!--<![endif]-->
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="description" content="" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>P7941 题解</title>
    <link
      rel="stylesheet"
      href="https://unpkg.com/purecss@2.0.6/build/pure-min.css"
      integrity="sha384-Uu6IeWbM+gzNVXJcM9XV3SohHtmWE+3VGi496jvgX1jyvDTXfdK+rfZc8C1Aehk5"
      crossorigin="anonymous"
    />
    <link
      href="//fonts.googleapis.com/css?family=Monda:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext"
      rel="stylesheet"
      type="text/css"
    />
    <link rel="stylesheet" href="https://unpkg.com/purecss@2.0.6/build/grids-responsive-min.css" />
    <link rel="stylesheet" href="https://unpkg.com/font-awesome@4.7.0/css/font-awesome.min.css" />
    <link rel="stylesheet" href="https://unpkg.com/katex@0.15.1/dist/katex.min.css" />
    <link rel="stylesheet" href="https://unpkg.com/highlight.js@11.3.1/styles/atom-one-light.css" />
    <link
      rel="stylesheet"
      href="https://unpkg.com/github-markdown-css@5.1.0/github-markdown-light.css"
    />
  <script defer src="../js/post.b40d710.js"></script><script defer src="../js/post/solution-p7941.2ac8404.js"></script><link href="../css/post-solution-p7941.3cba3c7.css" rel="stylesheet"></head>

  <body>
    <!--[if lt IE 7]>
      <p class="browsehappy">
        You are using an <strong>outdated</strong> browser. Please
        <a href="#">upgrade your browser</a> to improve your experience.
      </p>
    <![endif]-->
    <div id="wrap">
      <div id="sidebar" class="pure-menu">
  <a class="pure-menu-heading" href="/index.html">yzy1</a>
  <ul class="pure-menu-list">
    <li class="pure-menu-item">
      <a href="/index.html" class="pure-menu-link"><i class="fa fa-home"></i>博客</a>
    </li>
    <li class="pure-menu-item">
      <a href="/index.html" class="pure-menu-link"><i class="fa fa-tags"></i>标签</a>
    </li>
    <li class="pure-menu-item">
      <a href="/index.html" class="pure-menu-link"><i class="fa fa-file-code-o"></i>模板</a>
    </li>
    <li class="pure-menu-item menu-item-divided">
      <a href="/index.html" class="pure-menu-link"><i class="fa fa-external-link"></i>友链</a>
    </li>
    <li class="pure-menu-item">
      <a href="/about.html" class="pure-menu-link"><i class="fa fa-user"></i>关于</a>
    </li>
  </ul>
</div>

      <div id="main">

<header>
  <h1>P7941 题解</h1>
</header>
<section class="content">
  <div class="markdown-body"><p>首先考虑什么样的表达式是一个结果一定为 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span></span></span></span>，什么样的一定为 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span></span>，什么样的既可以为 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span></span></span></span> 也可以为 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span></span>。</p>
<ul>
<li>如果运算符为 <code>?</code>，则如果左操作数和右操作数确定且相同，则结果一定为左操作数。否则结果可以是 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span></span></span></span> 或 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span></span>。</li>
<li>如果运算符为 <code>&#x26;</code>，且左右操作数中至少有一个确定为 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span></span></span></span>，则结果一定为 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span></span></span></span>。否则如果两个操作数均确定，则结果为两操作数按位与的结果。否则结果可以是 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span></span></span></span> 或 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span></span>。</li>
<li>如果运算符为 <code>|</code>，且左右操作数中至少有一个确定为 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span></span>，则结果一定为 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span></span>。否则如果两个操作数均确定，则结果为两操作数按位或的结果。否则结果可以是 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span></span></span></span> 或 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span></span>。</li>
</ul>
<p>我们可以先建立出表达式树，从叶子节点到根节点依次转移即可。</p>
<pre><code class="hljs language-cpp"><span class="hljs-type">char</span> s[N], typ[N];
<span class="hljs-type">int</span> n, ls[N], rs[N], tp, ans[N];

<span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-type">int</span> <span class="hljs-title">And</span><span class="hljs-params">(<span class="hljs-type">int</span> x, <span class="hljs-type">int</span> y)</span> </span>{ <span class="hljs-keyword">return</span> (x == <span class="hljs-number">0</span> || y == <span class="hljs-number">0</span>) ? <span class="hljs-number">0</span> : <span class="hljs-built_in">max</span>(x, y); }
<span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-type">int</span> <span class="hljs-title">Or</span><span class="hljs-params">(<span class="hljs-type">int</span> x, <span class="hljs-type">int</span> y)</span> </span>{ <span class="hljs-keyword">return</span> (x == <span class="hljs-number">1</span> || y == <span class="hljs-number">1</span>) ? <span class="hljs-number">1</span> : <span class="hljs-built_in">max</span>(x, y); }

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">Dfs</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span> </span>{
  <span class="hljs-keyword">if</span> (x &#x3C;= <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> -x;
  <span class="hljs-type">int</span> l = <span class="hljs-built_in">Dfs</span>(ls[x]), r = <span class="hljs-built_in">Dfs</span>(rs[x]);
  <span class="hljs-keyword">if</span> (typ[x] == <span class="hljs-string">'&#x26;'</span>) <span class="hljs-keyword">return</span> ans[x] = <span class="hljs-built_in">And</span>(l, r);
  <span class="hljs-keyword">if</span> (typ[x] == <span class="hljs-string">'|'</span>) <span class="hljs-keyword">return</span> ans[x] = <span class="hljs-built_in">Or</span>(l, r);
  <span class="hljs-keyword">return</span> ans[x] = ((<span class="hljs-built_in">And</span>(l, r) == <span class="hljs-built_in">Or</span>(l, r)) ? <span class="hljs-built_in">And</span>(l, r) : <span class="hljs-number">2</span>);
}

<span class="hljs-function"><span class="hljs-type">signed</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-type">int</span> T;<span class="hljs-built_in">in</span>(T);<span class="hljs-keyword">while</span>(T--) {
    vector&#x3C;<span class="hljs-type">int</span>> vec;
    <span class="hljs-built_in">in</span>(n)(s + <span class="hljs-number">1</span>);
    <span class="hljs-built_in">re</span> (i, n) {
      <span class="hljs-keyword">if</span> (s[i] == <span class="hljs-string">'0'</span> || s[i] == <span class="hljs-string">'1'</span>)
        vec.<span class="hljs-built_in">push_back</span>(-(s[i] - <span class="hljs-string">'0'</span>));
      <span class="hljs-keyword">else</span>
        typ[++tp] = s[i], ls[tp] = vec.<span class="hljs-built_in">back</span>(), vec.<span class="hljs-built_in">pop_back</span>(), rs[tp] = vec.<span class="hljs-built_in">back</span>(), vec.<span class="hljs-built_in">back</span>() = tp;
    }
    <span class="hljs-built_in">Dfs</span>(tp);
    <span class="hljs-type">int</span> res = <span class="hljs-number">0</span>;
    <span class="hljs-built_in">re</span> (i, tp)
      <span class="hljs-keyword">if</span> (ans[i] == <span class="hljs-number">2</span>) ++res;
    <span class="hljs-built_in">out</span>(res)(<span class="hljs-string">'\n'</span>);
    <span class="hljs-built_in">rep</span> (i, <span class="hljs-number">0</span>, n + <span class="hljs-number">1</span>)
      s[i] = <span class="hljs-number">0</span>, typ[i] = <span class="hljs-number">0</span>, ls[i] = <span class="hljs-number">0</span>, rs[i] = <span class="hljs-number">0</span>, ans[i] = <span class="hljs-number">0</span>;
    tp = <span class="hljs-number">0</span>, n = <span class="hljs-number">0</span>;
  }
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre></div>
</section>
      </div>
    </div>
    <script src="https://unpkg.com/jquery@3.6.0/dist/jquery.min.js"></script>
  </body>
</html>

